from tqdm.notebook import tqdm

print("ğŸ“Š Modeller hazÄ±rlanÄ±yor...")
# single_prob ve cond_prob hazÄ±r olduÄŸunu varsayÄ±yoruz

print("ğŸ¯ TensorFlow ile tahminler yapÄ±lÄ±yor...")

def generate_predictions_tf_progress(n_preds, trials, single_prob, cond_prob):
    numbers = np.arange(1, 61)
    batch_size = 10000
    iterations = trials // batch_size

    single_prob_tf = tf.constant(single_prob.values, dtype=tf.float32)
    cond_prob_tf = tf.constant(cond_prob.values, dtype=tf.float32)

    results = []

    for pred_i in range(n_preds):
        best_score = -1
        best_combo = None

        # tqdm ilerleme Ã§ubuÄŸu burada
        for _ in tqdm(range(iterations), desc=f"Tahmin {pred_i+1}/{n_preds}"):
            samples = []
            for __ in range(batch_size):
                sampled = np.random.choice(numbers, size=6, replace=False, p=single_prob.values / single_prob.values.sum())
                samples.append(np.sort(sampled))
            combos = tf.constant(np.array(samples) - 1, dtype=tf.int32)

            sp_vals = tf.gather(single_prob_tf, combos)
            sp_product = tf.reduce_prod(sp_vals, axis=1)

            cp_product = tf.ones(batch_size, dtype=tf.float32)
            for x in range(6):
                for y in range(x+1, 6):
                    idx_a = combos[:, x]
                    idx_b = combos[:, y]
                    cond_vals = tf.gather_nd(cond_prob_tf, tf.stack([idx_a, idx_b], axis=1))
                    cp_product *= cond_vals

            scores = sp_product * cp_product
            max_idx = tf.argmax(scores).numpy()
            max_score = scores[max_idx].numpy()

            if max_score > best_score:
                best_score = max_score
                best_combo = combos[max_idx].numpy() + 1

        results.append((best_combo, best_score))

    return results

# Tahminleri Ã§alÄ±ÅŸtÄ±r
n_preds = 3
trials = 100000

results = generate_predictions_tf_progress(n_preds, trials, single_prob, cond_prob)

print("ğŸ‰ Tahminler hazÄ±r!")

for i, (combo, score) in enumerate(results, 1):
    print(f"{i}. Tahmin: {combo} | Skor: {score:.5e}")
